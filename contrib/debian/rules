#!/usr/bin/make -f

#export DH_VERBOSE=1

# Lucid does not have dh_python2, but we would like to be able to use this
# rules file to build on lucid as well. Thus the branching logic.
WITH_PYTHON2 = $(shell test -f /usr/bin/dh_python2 && echo "--with python2")
WITH_SPHINXDOC = $(shell test -f /usr/bin/dh_sphinxdoc && echo "--with sphinxdoc")


%:
	dh $@ \
		${WITH_SPHINXDOC} \
		${WITH_PYTHON2} \
		--with-quilt \
		--buildsystem=python_distutils

override_dh_auto_clean:
	make -C docs clean
	rm -fr dist build
	rm -fr plugins/mysql/dist plugins/mysql/build
	rm -fr plugins/lvm/dist plugins/lvm/build
	dh_auto_clean

override_dh_auto_build:
	dh_auto_build
	dh_auto_build -Dplugins/mysql
	dh_auto_build -Dplugins/lvm
	dh_auto_build -Dplugins/mysql-lvm
	dh_auto_build -Dplugins/pgsql

    # Build the HTML documentation.
	make -C docs html man

override_dh_auto_install:
	dh_auto_install -O--buildsystem=python_distutils
	dh_auto_install -O--buildsystem=python_distutils -Dplugins/mysql
	dh_auto_install -O--buildsystem=python_distutils -Dplugins/lvm
	dh_auto_install -O--buildsystem=python_distutils -Dplugins/mysql-lvm
	dh_auto_install -O--buildsystem=python_distutils -Dplugins/pgsql
